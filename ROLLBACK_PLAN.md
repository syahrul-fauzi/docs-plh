# Migration Rollback Plan

## Overview

This document outlines the procedures for rolling back changes if the tenant architecture migration encounters critical issues.

## Trigger Conditions

Rollback should be initiated if:
1.  **Critical Navigation Failure**: Users cannot access the dashboard via `/:tenantId`.
2.  **Data Leakage**: Tenant data is visible to unauthorized users.
3.  **Performance Degradation**: Significant increase in page load times or API latency.

## Rollback Procedures

### 1. Revert Middleware
The primary routing logic is in `middleware.ts`.
- **Action**: Revert `middleware.ts` to the previous version that relies solely on subdomains/headers.
- **Git Command**:
  ```bash
  git checkout HEAD~1 -- apps/web/src/middleware.ts
  ```

### 2. Disable UI Links
If the new pages are causing issues but middleware is fine, disable the links in the Sidebar.
- **Action**: Edit `Sidebar.tsx` to remove `getHref` logic and revert to static paths.
- **Code Change**:
  ```typescript
  // Revert this:
  // const getHref = (path) => ...
  
  // To this:
  // href: '/dashboard/cases'
  ```

### 3. Feature Flags
(If implemented) Toggle the `ENABLE_URL_TENANCY` feature flag to `false`.

## Training Guide for New Features

### For Users
- **New URL Structure**: Access your dashboard at `lawyershub.com/[your-tenant-id]/dashboard`.
- **Bookmarks**: Update your browser bookmarks to the new URL.
- **Sharing**: You can now copy-paste the URL to share specific pages with team members (they must have access).

### For Developers
- **Context Usage**: Always use `useTenant()` hook to get `tenantId`. Do not parse URL manually.
- **Navigation**: Use `Link` component with `href` generated by `getHref` helper (or equivalent routing utility).
- **Testing**: Add E2E tests for any new route to ensure tenant context preservation.
